# 2.2.1 创建历史性能任务

&#160; &#160; &#160; &#160;与创建实时性能任务像似，把所选择的采集对象和性能参数封装到`PmTask`中。实时性能的采集任务的采集粒度是默认的30秒，采集开始时间是任务创建时间，采集结束时间是开始时间的一个小时后；而历史性能的采集粒度可以从15分钟和24小时之间选择，采集开始时间和采集结束时间可以根据用户需求自行选择（采集结束时间应大于采集开始时间与采集粒度之和）。

&#160; &#160; &#160; &#160;点击创建任务按钮，最终会执行`PmService`中的`createHtPmTask（PmTask pmTask）`方法，该方法和实时性能的相应方法像似，只不过在创建任务时不仅要把`PmTask`放入`htTaskMap`集合中，还要执行`pmDao.saveEntity(pmTask)`方法将其保存到数据库中。在`onPolledData(polledData)`中，将`collect`后的数据封装到`PmTask`中，把`pmtask`中的values，也就是`List<PmData>`保存到数据库中的`pmData`表中。之后会发送一条`EmsMessage`消息，`PmHtTabView`中的`onMessage()`方法根据接收到的消息将创建的任务信息添加到历史任务列表中。